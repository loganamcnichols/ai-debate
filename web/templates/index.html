<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AI Debate</title>
  <link rel="stylesheet" href="static/css/styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Libre+Franklin:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/htmx.org@2.0.2/dist/htmx.js" integrity="sha384-yZq+5izaUBKcRgFbxgkRYwpHhHHCpp5nseXp0MEQ1A4MTWVMnqkmcuFez8x5qfxr" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/htmx-ext-sse@2.2.2/sse.js"></script>
  <script src="static/js/sse.min.js" defer></script>
  <script src="https://unpkg.com/hyperscript.org@0.9.12" defer></script>
</head>
<body>
  <main _="on scroll 
            if my scrollTop + my clientHeight is greater than my scrollHeight - 100 
              set userScrolling to true
            otherwise 
              set userScrolling to false
            end
           on htmx:sseMessage 
            if no userScrolling set my scrollTop to my scrollHeight 
            end
           on htmx:sseClose send wakeUp to #user-input
           on htmx:afterSettle set my scrollTop to my scrollHeight">
  {{ range $i, $val := .QuestionRows }}
  {{ if eq (mod $i 2) 0 }}
    <p class="user-msg">{{ .UserMsg }}</p>
    <div class="response-left">{{ .FirstResponse }}</div>
    <div class="response-right">{{ .SecondResponse }}</div>
  {{ else }}
    <p class="user-msg">{{ .UserMsg }}</p>
    <div class="response-right">{{ .FirstResponse }}</div>
    <div class="response-left">{{ .SecondResponse }}</div>
  {{ end }}
  {{ end }}
    <form id="submission-form" hx-post="/submit-question?response-id={{ .ResponseID }}&orientation={{ .Orientation }}"
          hx-trigger="keydown[key==='Enter'&&!shiftKey], submit" hx-swap="outerHTML show:bottom">
      <div class="textbar">
        <textarea name="user-msg" id="user-input" rows="1" 
        _="on keydown[key is 'Enter' and no shiftkey] halt the event's default 
           on input set my *height to my scrollHeight px"></textarea>
      </div>
    </form>
  </main>
</body>
</html>